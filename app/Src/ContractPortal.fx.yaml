ContractPortal As screen:
    OnVisible: |-
        =//  Sync    
        Set(_sync, true);
        Clear(ContractCollection);
        Clear(ContractCollectCollection);
        Collect(ContractCollectCollection, FindAllContracts.Run());
        ForAll(
            ContractCollectCollection,
            Collect(ContractCollection, { 
                uuid: UrlParser.Run(ThisRecord.uuid).uuid,
                number: ThisRecord.number,
                holder: FindHolderOfContractById.Run(UrlParser.Run(ThisRecord.uuid).uuid).name,
                beneficiary: FindBeneficiaryOfContractById.Run(UrlParser.Run(ThisRecord.uuid).uuid).name,
                type: FindTypeOfContractById.Run(UrlParser.Run(ThisRecord.uuid).uuid).name
            });
        );
        
        //  Check occurence if needed
        If(
            _doLookup,
            ForAll(
                ContractCollection,
                If(
                    ThisRecord.number = _lookupName,
                    Notify("Could not delete contract " & Char(34) & _lookupName & Char(34) & "!", NotificationType.Error);
                    Collect(CountCollection, ThisRecord)
                )
            )
        );
        
        If(
            And(_doLookup, CountRows(CountCollection) = 0),
            Notify("Successfully deleted contract " & Char(34) & _lookupName & Char(34) & "!", NotificationType.Success)
        );
        
        //  Clear variables/collections
        Clear(CountCollection);
        Set(_sync, false);
        Set(_doLookup, false);
        Set(_lookupName, "");
        Set(_eContractNumberSearch, "");
        Set(_eContractHolderSearch, "");
        Set(_eContractBeneficiarySearch, "");
        Set(_eContractTypeSearch, "");

    ProductPortalTitle_2 As label:
        Align: =Align.Center
        Color: =RGBA(151, 0, 0, 1)
        FontWeight: =FontWeight.Bold
        Height: =75
        Size: =25
        Text: |-
            ="Contract Portal
            "
        Width: =970
        ZIndex: =1

    "Products_2 As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver4.0'":
        Height: =673
        Items: =ContractCollection
        Layout: =Layout.Vertical
        OnSelect: =
        TemplatePadding: =0
        TemplateSize: =111
        Width: =950
        X: =20
        Y: =75
        ZIndex: =2

        eProdNameLabel_2 As label:
            OnSelect: =Select(Parent)
            Text: |-
                ="Number: " & ThisItem.number
            Width: =351
            X: =8
            Y: =15
            ZIndex: =1

        eProdDepartmentLabel_2 As label:
            OnSelect: =Select(Parent)
            Text: |-
                ="Type: " & ThisItem.type
            Width: =351
            X: =8
            Y: =55
            ZIndex: =2

        ProductSeparator_2 As rectangle:
            Fill: =RGBA(116, 116, 116, 1)
            Height: =1
            OnSelect: =Select(Parent)
            Width: =950
            Y: =110
            ZIndex: =3

        RemoveProductIcon_2 As icon.Trash:
            Color: =RGBA(116, 116, 116, 1)
            Height: =80
            Icon: =Icon.Trash
            OnSelect: |-
                =//  Set basic variables
                Set(_lookupName, ThisItem.number);
                Set(_sync, true);
                
                //  Delete product
                DeleteContractByID.Run(UrlParser.Run(ThisItem.uuid).uuid);
                
                //  Sync
                Clear(ContractCollection);
                Clear(ContractCollectCollection);
                Collect(ContractCollectCollection, FindAllContracts.Run());
                ForAll(
                    ContractCollectCollection,
                    Collect(ContractCollection, { 
                        uuid: UrlParser.Run(ThisRecord.uuid).uuid,
                        number: ThisRecord.number,
                        holder: FindHolderOfContractById.Run(UrlParser.Run(ThisRecord.uuid).uuid).name,
                        beneficiary: FindBeneficiaryOfContractById.Run(UrlParser.Run(ThisRecord.uuid).uuid).name,
                        type: FindTypeOfContractById.Run(UrlParser.Run(ThisRecord.uuid).uuid).name
                    });
                );
                
                //  Check synced collection for occurrence of the item
                ForAll(
                    PartyCollection,
                    If(
                        ThisRecord.name = _lookupName,
                        Notify("Could not delete party " & Char(34) & _lookupName & Char(34) & "!", NotificationType.Error);
                        Collect(CountCollection, ThisRecord)
                    )
                );
                
                If(
                    CountRows(CountCollection) = 0,
                    Notify("Successfully deleted party " & Char(34) & _lookupName & Char(34) & "!", NotificationType.Success)
                );
                
                //  Clear collections/variables
                Clear(CountCollection);
                Set(_lookupName, "");
                Set(_sync, false);
            PaddingBottom: =20
            PaddingTop: =20
            Width: =80
            X: =710
            Y: =15
            ZIndex: =4

        EditProductIcon_2 As icon.Edit:
            Color: =RGBA(116, 116, 116, 1)
            Height: =80
            Icon: =Icon.Edit
            OnSelect: |-
                =Navigate(ContractEditor, None, 
                    {
                        number: ThisItem.number,
                        type: ThisItem.type,
                        holder: ThisItem.holder,
                        beneficiary: ThisItem.beneficiary
                    }
                );
            PaddingBottom: =20
            PaddingTop: =20
            Width: =80
            X: =790
            Y: =15
            ZIndex: =5

        SpecProductIcon_2 As icon.NextArrow:
            Color: =RGBA(116, 116, 116, 1)
            Height: =80
            Icon: =Icon.NextArrow
            OnSelect: |-
                =//Navigate(ProductSpecification, None, {name: ThisItem.name, department: ThisItem.department, uuid: UrlParser.Run(ThisItem.uuid).uuid});
            PaddingBottom: =20
            PaddingTop: =20
            Width: =80
            X: =870
            Y: =15
            ZIndex: =6

        eProdDepartmentLabel_3 As label:
            OnSelect: =Select(Parent)
            Text: |-
                ="Beneficiary: " & ThisItem.beneficiary
            Width: =351
            X: =359
            Y: =55
            ZIndex: =7

        eProdNameLabel_3 As label:
            OnSelect: =Select(Parent)
            Text: |-
                ="Holder: " & ThisItem.holder
            Width: =351
            X: =359
            Y: =15
            ZIndex: =8

    eProdOptFilter_2 As label:
        Height: =50
        Text: ="Optional Filters"
        Width: =300
        X: =990
        Y: =75
        ZIndex: =3

    eProdNameFilter_2 As label:
        Height: =50
        Text: |-
            ="Number
            "
        Width: =115
        X: =990
        Y: =126
        ZIndex: =4

    eProdNameInput_2 As text:
        BorderColor: =RGBA(151, 0, 0, 1)
        Default: =_eContractNumberSearch
        Height: =35
        HintText: ="Number"
        HoverBorderColor: =RGBA(151, 0, 0, 1)
        HoverFill: =RGBA(238, 204, 204, 1)
        Width: =241
        X: =1105
        Y: =133
        ZIndex: =5

    eProdDepFilter_2 As label:
        Height: =50
        Text: ="Type"
        Width: =115
        X: =990
        Y: =176
        ZIndex: =6

    eProdDepInput_2 As text:
        BorderColor: =RGBA(151, 0, 0, 1)
        Default: =_eContractTypeSearch
        Height: =35
        HintText: ="Type"
        HoverBorderColor: =RGBA(151, 0, 0, 1)
        HoverFill: =RGBA(238, 204, 204, 1)
        Width: =241
        X: =1105
        Y: =183
        ZIndex: =7

    eProdSyncIcon_2 As icon.Sync:
        Color: =RGBA(116, 116, 116, 1)
        Height: =80
        Icon: =Icon.Sync
        OnSelect: |-
            =Set(_sync, true);
            Clear(ContractCollection);
            Clear(ContractCollectCollection);
            Collect(ContractCollectCollection, FindAllContracts.Run());
            
            ForAll(
                ContractCollectCollection,
                Collect(ContractCollection, { 
                    uuid: UrlParser.Run(ThisRecord.uuid).uuid,
                    number: ThisRecord.number,
                    holder: FindHolderOfContractById.Run(UrlParser.Run(ThisRecord.uuid).uuid).name,
                    beneficiary: FindBeneficiaryOfContractById.Run(UrlParser.Run(ThisRecord.uuid).uuid).name,
                    type: FindTypeOfContractById.Run(UrlParser.Run(ThisRecord.uuid).uuid).name
                });
            );
            Set(_sync, false)
        PaddingBottom: =20
        PaddingTop: =20
        Width: =80
        X: =1266
        Y: =668
        ZIndex: =8

    eProdSync_2 As label:
        Align: =Align.Right
        Text: ="Syncing..."
        Visible: =_sync
        X: =1122
        Y: =688
        ZIndex: =9

    eProdToHome_8 As icon.BackArrow:
        Color: =RGBA(116, 116, 116, 1)
        Height: =75
        Icon: =Icon.BackArrow
        OnSelect: =Back()
        PaddingBottom: =16
        PaddingTop: =16
        Width: =75
        X: =1290
        ZIndex: =10

    Icon12_2 As icon.Add:
        Color: =RGBA(116, 116, 116, 1)
        Height: =80
        Icon: =Icon.Add
        OnSelect: =Navigate(ContractCreator);
        PaddingBottom: =20
        PaddingTop: =20
        Width: =80
        X: =890
        ZIndex: =11

    eProdDepFilter_3 As label:
        Height: =50
        Text: ="Holder"
        Width: =115
        X: =990
        Y: =226
        ZIndex: =12

    eProdDepFilter_4 As label:
        Height: =50
        Text: ="Beneficiary"
        Width: =115
        X: =990
        Y: =276
        ZIndex: =13

    eProdDepInput_3 As text:
        BorderColor: =RGBA(151, 0, 0, 1)
        Default: =_eContractHolderSearch
        Height: =35
        HintText: ="Holder"
        HoverBorderColor: =RGBA(151, 0, 0, 1)
        HoverFill: =RGBA(238, 204, 204, 1)
        Width: =241
        X: =1105
        Y: =233
        ZIndex: =14

    eProdDepInput_4 As text:
        BorderColor: =RGBA(151, 0, 0, 1)
        Default: =_eContractBeneficiarySearch
        Height: =35
        HintText: ="Beneficiary"
        HoverBorderColor: =RGBA(151, 0, 0, 1)
        HoverFill: =RGBA(238, 204, 204, 1)
        Width: =241
        X: =1105
        Y: =283
        ZIndex: =15

